#!/bin/bash

set -xe

REDIS_PROVIDER_URL=$(bin/redis-info)

# This sources POSTGRES_* env vars.
source bin/postgresql-info

echo $POSTGRES_HOST
echo $POSTGRES_PORT

START_DISCOURSE="sudo docker run -e REDIS_PROVIDER_URL=$REDIS_PROVIDER_URL -e POSTGRES_HOST=$POSTGRES_HOST -e POSTGRES_PORT=$POSTGRES_PORT \
     -v $(pwd)/data/discourse-public:/discourse/public \
     srid/discourse"

# $START_DISCOURSE "/discourse/docker/setup.sh"
$START_DISCOURSE /discourse/docker/start.sh 'bundle exec rails s'
