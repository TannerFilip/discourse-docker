#!/bin/bash

set -xe

HOSTIP=$(/sbin/ifconfig eth0 | grep "inet addr" | awk -F: '{print $2}' | awk '{print $1}')
DISCOURSE_PORT=3000

NGINX_PORT=${NGINX_PORT:=4000}

# Assign static port (NGINX_PORT) for nginx front so that it can be
# reliably used in the frontend's config file.
exec sudo docker run \
    -e SITE_PORT=$DISCOURSE_PORT \
    -e SITE_HOST=$HOSTIP \
    -e SITE_NAME=discourse.example.com \
    -p $NGINX_PORT:80 \
    -v $(pwd)/data/discourse-public:/discourse-public \
    srid/nginx:1.3
